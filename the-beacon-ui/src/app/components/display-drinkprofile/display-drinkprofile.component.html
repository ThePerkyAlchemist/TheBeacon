<!-- Page Title -->
<h2>Drink Profiles</h2>

<!-- Toolbar with Create and Search -->
<div class="table-toolbar">
  <!-- Left-aligned create button -->
  <button mat-raised-button color="primary" (click)="startCreating()">
    Create New Drink Profile
  </button>

  <!-- Right-aligned search input -->
  <mat-form-field appearance="outline" class="search-field" style="min-width: 250px;">
    <mat-label>Search Drink Profiles</mat-label>
    <input matInput (keyup)="applyFilter($any($event.target).value)" placeholder="Filter drink profiles..." />
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>
</div>

<!-- Show this section only when creating a new drink profile -->
<div *ngIf="showCreateForm" class="form-container">
  <h3>New Drink Profile</h3>

  <!-- Template-driven form for new profile -->
  <form (ngSubmit)="createProfile()" #createForm="ngForm">

    <!-- Recipe ID -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Recipe ID</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.recipeId" name="recipeId" required #recipeIdInput="ngModel" />
      <mat-error *ngIf="recipeIdInput.invalid && recipeIdInput.touched">Recipe ID is required</mat-error>
    </mat-form-field>

    <!-- Sweetness -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Sweetness</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.sweetnessOrFruitiness" name="sweetness" required #sweetnessInput="ngModel" />
      <mat-error *ngIf="sweetnessInput.invalid && sweetnessInput.touched">Sweetness is required</mat-error>
    </mat-form-field>

    <!-- Richness -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Richness</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.richness" name="richness" required #richnessInput="ngModel" />
      <mat-error *ngIf="richnessInput.invalid && richnessInput.touched">Richness is required</mat-error>
    </mat-form-field>

    <!-- Booziness -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Booziness</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.booziness" name="booziness" required #boozinessInput="ngModel" />
      <mat-error *ngIf="boozinessInput.invalid && boozinessInput.touched">Booziness is required</mat-error>
    </mat-form-field>

    <!-- Sourness -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Sourness</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.sourness" name="sourness" required #sournessInput="ngModel" />
      <mat-error *ngIf="sournessInput.invalid && sournessInput.touched">Sourness is required</mat-error>
    </mat-form-field>

    <!-- Freshness -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Freshness</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.freshness" name="freshness" required #freshnessInput="ngModel" />
      <mat-error *ngIf="freshnessInput.invalid && freshnessInput.touched">Freshness is required</mat-error>
    </mat-form-field>

    <!-- Lightness -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Lightness</mat-label>
      <input matInput type="number" [(ngModel)]="newProfile.lightness" name="lightness" required #lightnessInput="ngModel" />
      <mat-error *ngIf="lightnessInput.invalid && lightnessInput.touched">Lightness is required</mat-error>
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <input matInput [(ngModel)]="newProfile.description" name="description" required #descriptionInput="ngModel" />
      <mat-error *ngIf="descriptionInput.invalid && descriptionInput.touched">Description is required</mat-error>
    </mat-form-field>

    <!-- Action Buttons -->
    <button mat-raised-button color="primary" type="submit" [disabled]="createForm.invalid">Save Profile</button>
    <button mat-raised-button color="warn" type="button" (click)="cancelCreate()">Cancel</button>
  </form>
</div>

<!-- Edit form shown when editing an existing profile -->
<div *ngIf="editingProfile" class="form-container">
  <h3>Edit Drink Profile</h3>

  <form (ngSubmit)="saveProfile()" #editForm="ngForm">

    <!-- Each field uses the same layout and appearance -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Recipe ID</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.recipeId" name="editRecipeId" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Sweetness</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.sweetnessOrFruitiness" name="editSweetness" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Richness</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.richness" name="editRichness" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Booziness</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.booziness" name="editBooziness" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Sourness</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.sourness" name="editSourness" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Freshness</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.freshness" name="editFreshness" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Lightness</mat-label>
      <input matInput type="number" [(ngModel)]="editingProfile.lightness" name="editLightness" required />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Description</mat-label>
      <input matInput [(ngModel)]="editingProfile.description" name="editDescription" required />
    </mat-form-field>

    <!-- Buttons for editing -->
    <button mat-raised-button color="primary" type="submit" [disabled]="editForm.invalid">Save Changes</button>
    <button mat-raised-button color="warn" type="button" (click)="cancelEdit()">Cancel</button>
  </form>
</div>

<!-- Table Section -->
  <mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

    <!-- Define columns -->
    <ng-container matColumnDef="recipeId">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Recipe ID</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.recipeId }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="sweetness">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Sweetness</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.sweetnessOrFruitiness }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="richness">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Richness</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.richness }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="booziness">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Booziness</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.booziness }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="sourness">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Sourness</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.sourness }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="freshness">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Freshness</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.freshness }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="lightness">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Lightness</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.lightness }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="description">
      <mat-header-cell *matHeaderCellDef mat-sort-header>Description</mat-header-cell>
      <mat-cell *matCellDef="let profile">{{ profile.description }}</mat-cell>
    </ng-container>

    <!-- Actions column -->
    <ng-container matColumnDef="actions">
      <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
      <mat-cell *matCellDef="let profile">
        <button mat-icon-button color="accent" (click)="startEditing(profile)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="deleteProfile(profile.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-cell>
    </ng-container>

    <!-- Render rows -->
    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

  </mat-table>

  <!-- Pagination -->
  <mat-paginator
    [pageSizeOptions]="[5, 10, 25]"
    showFirstLastButtons
    aria-label="Select page">
  </mat-paginator>

