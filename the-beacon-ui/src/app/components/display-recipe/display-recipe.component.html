<!-- Page Title -->
<h2>Recipes</h2>

<!-- Toolbar Section: Create Button and Search Field -->
<div class="table-toolbar">
  <!-- Button to open the form for creating a new recipe -->
  <button mat-raised-button color="primary" (click)="startCreating()">
    Create New Recipe
  </button>

  <!-- Search input for filtering the recipe table -->
  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Search Recipes</mat-label>
    <input
      matInput
      (keyup)="applyFilter($any($event.target).value)"
      placeholder="Filter recipes..."
    />
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>
</div>

<!-- Form Section: Create or Edit Recipe -->
<div *ngIf="showForm" class="form-container">
  <!-- Dynamic title based on whether a recipe is being edited or created -->
  <h3>{{ editingRecipe ? 'Edit Recipe' : 'New Recipe' }}</h3>

  <!-- Reactive form bound to recipeForm -->
  <form [formGroup]="recipeForm" (ngSubmit)="saveRecipe()">

    <!-- Name Input -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" />
    </mat-form-field>

    <!-- Ingredient ID Input -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Ingredient ID</mat-label>
      <input matInput type="number" formControlName="ingredientId" />
    </mat-form-field>

    <!-- Volume Input -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Volume (ml)</mat-label>
      <input matInput type="number" formControlName="volumeMl" />
    </mat-form-field>

    <!-- Save and Cancel Buttons -->
    <div style="margin-top: 1rem;">
      <!-- Save button is disabled if form is invalid -->
      <button mat-raised-button color="primary" type="submit" [disabled]="recipeForm.invalid">
        Save
      </button>

      <!-- Cancel button closes the form -->
      <button mat-raised-button color="warn" type="button" (click)="cancelForm()">
        Cancel
      </button>
    </div>
  </form>
</div>

<!-- Success Message Display -->
<div *ngIf="successMessage" style="color: green; margin-bottom: 1rem;">
  {{ successMessage }}
</div>

<!-- Recipe Table Section -->
<table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 ingredient-table">

  <!-- Name Column -->
  <ng-container matColumnDef="name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
    <td mat-cell *matCellDef="let item">{{ item.name }}</td>
  </ng-container>

  <!-- Ingredient ID Column -->
  <ng-container matColumnDef="ingredientId">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Ingredient ID</th>
    <td mat-cell *matCellDef="let item">{{ item.ingredientId }}</td>
  </ng-container>

  <!-- Volume Column -->
  <ng-container matColumnDef="volumeMl">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Volume</th>
    <td mat-cell *matCellDef="let item">{{ item.volumeMl }}</td>
  </ng-container>

  <!-- Actions Column (Edit/Delete buttons) -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Actions</th>
    <td mat-cell *matCellDef="let item">
      <!-- Edit Recipe -->
      <button mat-icon-button color="accent" (click)="startEditing(item)" matTooltip="Edit">
        <mat-icon>edit</mat-icon>
      </button>

      <!-- Delete Recipe -->
      <button mat-icon-button color="warn" (click)="deleteRecipe(item.id)" matTooltip="Delete">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <!-- Table Header and Rows -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<!-- Paginator for Table -->
<mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
